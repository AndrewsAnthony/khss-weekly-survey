include ./tooltipborder

mixin display-house-district-sector(modelhouse, modeltype, modelid)
  .list
    - var groupHouses = viewHelper.groupHouseByDistrictAndSector(modelhouse)
    | #{console.log(groupHouses)}
    each district in R.keys(groupHouses)
      h4
        i
          | #{district} район
          | #{" "}
          span.label.label-primary #{R.reduce(R.add, 0, R.map(R.length, R.values(groupHouses[district])))} адресов
      hr
      each sector in R.keys(groupHouses[district])
        each house in R.keys(groupHouses[district][sector])
          - var groupTask = R.groupBy(task => {return ((task.taskable == modeltype) && (task.taskable_id == modelid)) ? 'current' : 'parallel' })( groupHouses[district][sector][house].ItemTasks)
          .panel-group
            if (groupTask.current)
              +tooltipborder("Статус - " + viewHelper.tooltipTitle(R.head(groupTask.current).status))
            div(class= "panel panel-default")
              .panel-heading(id= ((groupTask.current) ? viewHelper.addBorderStyle(R.head(groupTask.current).status) : ''))
                h4.panel-title
                  a(
                  data-toggle="collapse"
                  href="#house" + groupHouses[district][sector][house].id)
                    span.badge.pull-right #{groupHouses[district][sector][house].ItemTasks.length}
                    span.searchtext
                      | #{viewHelper.createNameHouse(groupHouses[district][sector][house])}
                      br
                      | #{sector} участок

              .panel-collapse.collapse(id="house" + groupHouses[district][sector][house].id)
                .panel-body
                  p
                    i
                      a(href='/house/' + groupHouses[district][sector][house].id) Подробная информация по адресу
                  if (groupTask.current)
                    p
                      i
                        u Текущие задачи
                    each task in groupTask.current
                      +history(task, '../../..')
                  if (groupTask.parallel)
                    p
                      i
                        u Параллельные задачи
                    each task in groupTask.parallel
                      +history(task, '../../..')